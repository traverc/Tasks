#include <stdio.h>
#include "freertos/FreeRTOS.h"
#include "freertos/task.h"
#include "driver/gpio.h"

#define LED_PIN  GPIO_NUM_10        //Choose a good LED pin to use
#define DELAY_LED 1000
#define DELAY_PRINT 1000
/* Print task prints message every second 10 times, then suspends itself
led task counts up and blinks, and when it gets to 50 it resumes the print 
task, which prints a goodbye message and then deletes itself, and the LED 
task keeps running.*/

void led_task()
{
    int counter = 0;
    gpio_reset_pin(LED_PIN);
    gpio_set_direction(LED_PIN, GPIO_MODE_OUTPUT);

    while (true)
    {
        printf("LED Task: counter = %d\n", counter);
        gpio_set_level(LED_PIN, (counter % 2) ? 0 : 1);
        counter++;
        vTaskDelay(DELAY_LED / portTICK_PERIOD_MS);
        if (counter == 50) {
        }
    }
}
void print_task()
{
    while (true)
    {
        for(int i = 0; i <10; i++) {
        printf("Repeating Message %d \n", i);
        vTaskDelay(DELAY_PRINT / portTICK_PERIOD_MS);
        }
        printf("Print task deleting itself\n");
        vTaskDelete(NULL);
    }
}

void app_main(void)
{
    TaskHandle_t print_handle;
 //   xTaskCreatePinnedToCore(led_task, "LED_Task", 2048, NULL, 5, NULL, 1);
    xTaskCreatePinnedToCore(print_task, "PRINT_Task", 2048, NULL, 3, &print_handle, 0);
    vTaskDelay(5000 / portTICK_PERIOD_MS);
      vTaskSuspend(print_handle);
    printf("Print task suspented by app_main\n");
      vTaskDelay(1000 / portTICK_PERIOD_MS);
      vTaskResume(print_handle);
    printf("Print task resumed by app_main\n");
}
