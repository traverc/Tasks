//Activity 8 Using FreeRTOS Timers
#include <stdio.h>
#include "freertos/FreeRTOS.h"
#include "freertos/timers.h"
#include "driver/gpio.h"

#define LED_PIN    10    //Choose an LED pin
#define TIMER_PERIOD_MS 250

TimerHandle_t led_timer;

// Timer callback function
void led_timer_callback(TimerHandle_t xTimer)
{
    static int led_state = 0;
    led_state = !led_state;
    gpio_set_level(LED_PIN, led_state);
//   printf("Timer callback executed! LED state = %d\n", led_state);
}

void app_main(void)
{
    gpio_reset_pin(LED_PIN);
    gpio_set_direction(LED_PIN, GPIO_MODE_OUTPUT);

    // Create timer
    led_timer = xTimerCreate("LED_Timer", pdMS_TO_TICKS(TIMER_PERIOD_MS), pdTRUE, (void *)0, led_timer_callback);

    if (led_timer == NULL)
    {
        printf("Failed to create timer.\n");
    }
    else
    {
        printf("Starting LED timer...\n");
        xTimerStart(led_timer, 0);
    }
}

